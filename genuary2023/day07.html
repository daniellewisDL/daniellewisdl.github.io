<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Genuary 2023</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>body { font-family: monospace; }</style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js"></script>
  </head>

  <body style="background-color: rgb(255, 255, 255);">
    <header>
      <h1>Genuary 2023 | Day 7 | Sample a color palette from a movie</h3>
    </header>
    <div id="myCanvas"></div>

    <script>
      
      var s = function( p ) {

          let canvas
          let frame_rate = 10
          let width = 600
          let height = 400
          let myImageOriginal
          let myArrayOfColors = []


          p.preload = function() {
            // myImageOriginal = p.loadImage('assets/matrix4.png')
            myImage = p.loadImage('assets/'+p.random(['shawshank.png','matrix.png','matrix4.png','up.png']))
          }

          p.setup = function() {
              canvas = p.createCanvas(width,height)
              p.frameRate(frame_rate)
              p.background(230)

            }

          p.draw = function() {
            p.noLoop()
            p.image(myImage, 10, height/4, width/2, height/2)
            myImage.loadPixels()
            console.log(myImage.pixels)
            for (let i = 0; i < myImage.pixels.length; i=i+4) {
              myArrayOfColors.push([myImage.pixels[i],myImage.pixels[i+1],myImage.pixels[i+2],myImage.pixels[i+3]])
            }
            myArrayOfColors.sort()
            let uniqueColors = Array.from(new Set(myArrayOfColors.map(JSON.stringify)), JSON.parse)
            console.log(uniqueColors)

            var sortedRgbArr = uniqueColors.map(function(c, i) {
                // Convert to HSL and keep track of original indices
                return {color: rgbToHsl(c), index: i};
              }).sort(function(c1, c2) {
                // Sort by hue
                return c1.color[0] - c2.color[0];
              }).map(function(data) {
                // Retrieve original RGB color
                return uniqueColors[data.index];
              });


            p.noStroke()
            for (let i = 0; i < sortedRgbArr.length; i++) {
                p.fill(sortedRgbArr[i][0],sortedRgbArr[i][1],sortedRgbArr[i][2])
                p.rect( 20+ i%((width-80)/2) +width/2,20+Math.floor(i/((width-40)/2)),1,1)
            }
          }
        
          function rgbToHsl(c) {
              var r = c[0]/255, g = c[1]/255, b = c[2]/255;
              var max = Math.max(r, g, b), min = Math.min(r, g, b);
              var h, s, l = (max + min) / 2;

              if(max == min) {
                h = s = 0; // achromatic
              } else {
                var d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch(max){
                  case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                  case g: h = (b - r) / d + 2; break;
                  case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
              }
              return new Array(h * 360, s * 100, l * 100);
            }

        }

      
      let myp5 = new p5(s, "myCanvas")

    </script>
  </body>
</html>
